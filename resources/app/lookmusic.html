<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <script src="./include.js"></script>
    <title>filter</title>
    <!-- Tocas UI：CSS 與元件 -->
    <link rel="stylesheet" href="./tocasUI/tocas.css" />
    <!-- Tocas JS：模塊與 JavaScript 函式 -->
    <script src="./tocasUI/tocas.js"></script>
</head>

<body style="background-color:#e4e4e4;">
    <div id="lookmusic"></div>
</body>
<script>
    let colortrf = function(color_obj) {
        let temp = {};
        temp.background = "0x" + color_obj.background.split("#")[1];
        temp.X_axis = "0x" + color_obj.X_axis.split("#")[1];
        temp.Y_axis = "0x" + color_obj.Y_axis.split("#")[1];
        temp.dataBar = "0x" + color_obj.dataBar.split("#")[1];
        temp.mark = "0x" + color_obj.mark.split("#")[1];
        return temp;
    }
    let lookmusic_set_data = CCmain.readFile("./resources/app/set.json") || {};
    let lookmusic = new CCmain.viewData([0], lookmusic_set_data.width, lookmusic_set_data.height, lookmusic_set_data.width_rate, "lookmusic", colortrf(lookmusic_set_data.colorset));
</script>

<script>
    let lm = new BroadcastChannel('lookmusic');
    lm.postMessage("ready");
    lm.onmessage = function(ev) {
        let temp = JSON.parse(ev.data);
        temp = Object.keys(temp).map(function(_) {
            return temp[_];
        });
        lookmusic.setView(temp, lookmusic_set_data.width, lookmusic_set_data.height, lookmusic_set_data.width_rate, "lookmusic", colortrf(lookmusic_set_data.colorset));
    };
</script>
<script>
    keyboardJS.bind("a", function() {
        lookmusic.viewShift(-10);
    });
    keyboardJS.bind("d", function() {
        lookmusic.viewShift(10);
    });
    keyboardJS.bind("w", function() {
        lookmusic.enlarge(1.1);
    });
    keyboardJS.bind("s", function() {
        lookmusic.enlarge(1 / 1.1);
    });
</script>

</html>